------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/kw/Documents/GitHub/long-covid-symptoms/12_longCovidSymp_figure1contemporary.log
  log type:  text
 opened on:   9 Nov 2022, 22:26:17

. 
. *list of all outcomes
. global diagnosisOutcomes tEver_infect_parasite tEver_neoplasms tEver_blood_diseases tEver_endocr_nutr_dis tEver_mental
> _disorder tEver_nervous_sys_dis tEver_ear_mastoid_dis tEver_circ_sys_dis tEver_resp_system_dis tEver_digest_syst_dis t
> Ever_skin_disease tEver_musculo_dis tEver_genitourin_dis tEver_pregnancy_compl tEver_perinatal_dis tEver_congenital_di
> s tEver_injury_poison

. 
.         
. prog drop _all

. 
. prog define outputORsforOutcome
  1.         syntax, outcome(string)
  2.         *above will need edited when also have the historical population to compare to
. 
.         *get denominator                        
.         count
  3.         local denom=r(N)
  4.         *get number of people with specific outcome (events column)
.         cou if `outcome' == 1
  5.         local events=r(N)
  6.         *calculate proportion of people with events
.         local percWEvent=100*(`events'/`denom')
  7.         *get ORs for each regression analysis
.         *crude 
.         display "`outcome' adjusted only for matched"
  8.         capture noisily clogit `outcome' i.expStatus, strata(set_id) or
  9.         local hr_crude = r(estimate)
 10.         local lb_crude = r(lb)
 11.         local ub_crude = r(ub)
 12.         *depr and ethnicity adjusted
.         display "`outcome' additionally adjusted for deprivation and ethnicity"
 13.         capture noisily clogit `outcome' i.expStatus i.imd i.ethnicity, strata(set_id) or
 14.         local hr_deprEth_adj = r(estimate)
 15.         local lb_deprEth_adj = r(lb)
 16.         local ub_deprEth_adj = r(ub)
 17.         *fully adjusted
.         display "`outcome' additionally adjusted for rural/urban status"
 18.         capture noisily clogit `outcome' i.imd i.ethnicity i.rural_urban, strata(set_id) or
 19.         local hr_full_adj = r(estimate)
 20.         local lb_full_adj = r(lb)
 21.         local ub_full_adj = r(ub)
 22.                                         
.         *get variable name
.         local varLab: variable label `outcome'
 23.         display "`varLab'"
 24.         *get category name
.         *local category: label `catLabel' `i'
.         *display "Category label: `category'"
.         
.         *write each row
.         *crude 
.         file write tablecontents  ("`varLab'") _tab _tab ("Crude") _tab %4.2f (`hr_crude')  " (" %4.2f (`lb_crude') "-
> " %4.2f (`ub_crude') ")" _tab (`events') _tab (" (") %3.1f (`percWEvent') (")")  _n
 25.         *depr and ethnicity adjusted
.         file write tablecontents  _tab _tab ("Adjusted for deprivation & ethnicity") _tab %4.2f (`hr_deprEth_adj')  " 
> (" %4.2f (`lb_deprEth_adj') "-" %4.2f (`ub_deprEth_adj ') ")"  _n
 26.         *fully adjusted
.         file write tablecontents  _tab _tab ("Additionally adjusted for rural/urban") _tab %4.2f (`hr_full_adj')  " ("
>  %4.2f (`lb_full_adj') "-" %4.2f (`ub_full_adj ') ")"  _n
 27. 
. end

. 
. *call program and output tables
. 
. use ./output/longCovidSymp_analysis_dataset_contemporary.dta, clear

. rename case expStatus

. file open tablecontents using ./output/figure1PanelB_longCovidSymp_contemporary.txt, t w replace
(note: file ./output/figure1PanelB_longCovidSymp_contemporary.txt not found)

. file write tablecontents "Fig 1: Panel B. Community COVID-19: Odds ratios comparing odds of post-COVID diagnoses at an
> y time during follow up in community COVID-19 compared to comparator populations." _n _n

. file write tablecontents ("Diagnoses") _tab ("Comparator") _tab _tab ("OR (95% CI)") _tab ("Number of events") _tab ("
> Proportion of population with events") _n

. 
. *loop through each outcome
. *foreach outcome in $diagnosisOutcomes {
. foreach outcome in tEver_infect_parasite {
  2.         cap noisily outputORsforOutcome, outcome(`outcome')
  3.         file write tablecontents _n
  4. }
  49,800
  39,929
tEver_infect_parasite adjusted only for matched
note: multiple positive outcomes within groups encountered.
note: 4,998 groups (18,882 obs) dropped because of all positive or
      all negative outcomes.

Iteration 0:   log likelihood = -11569.715  
Iteration 1:   log likelihood = -11563.532  
Iteration 2:   log likelihood = -11563.531  

Conditional (fixed-effects) logistic regression

                                                Number of obs     =     30,918
                                                LR chi2(1)        =       0.00
                                                Prob > chi2       =     0.9729
Log likelihood = -11563.531                     Pseudo R2         =     0.0000

---------------------------------------------------------------------------------------
tEver_infect_parasite | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
----------------------+----------------------------------------------------------------
            expStatus |
                Case  |   1.000912   .0268554     0.03   0.973     .9496364    1.054956
---------------------------------------------------------------------------------------
tEver_infect_parasite additionally adjusted for deprivation and ethnicity
note: multiple positive outcomes within groups encountered.
note: 5,610 groups (18,669 obs) dropped because of all positive or
      all negative outcomes.

Iteration 0:   log likelihood = -9745.4694  
Iteration 1:   log likelihood = -9740.6033  
Iteration 2:   log likelihood = -9740.6027  

Conditional (fixed-effects) logistic regression

                                                Number of obs     =     26,166
                                                LR chi2(9)        =       3.39
                                                Prob > chi2       =     0.9470
Log likelihood = -9740.6027                     Pseudo R2         =     0.0002

-----------------------------------------------------------------------------------------
  tEver_infect_parasite | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------+----------------------------------------------------------------
              expStatus |
                  Case  |   .9830426   .0284875    -0.59   0.555     .9287642    1.040493
                        |
                    imd |
      1 least deprived  |   .9828253   .0678035    -0.25   0.802     .8585257    1.125121
                     2  |   .9602689   .0659598    -0.59   0.555     .8393146    1.098654
                     3  |   .9784176   .0672378    -0.32   0.751     .8551235    1.119489
                     4  |   1.013316   .0697887     0.19   0.848     .8853626    1.159761
       5 most deprived  |    .973844   .0671686    -0.38   0.701     .8507065    1.114805
                        |
              ethnicity |
                 Mixed  |   .9791209   .0381618    -0.54   0.588     .9071106    1.056848
Asian or Asian British  |   .9904482   .0388877    -0.24   0.807     .9170886    1.069676
                 Other  |   .9571463   .0376742    -1.11   0.266     .8860826    1.033909
-----------------------------------------------------------------------------------------
tEver_infect_parasite additionally adjusted for rural/urban status
note: multiple positive outcomes within groups encountered.
note: 5,610 groups (18,669 obs) dropped because of all positive or
      all negative outcomes.

Iteration 0:   log likelihood = -9736.4501  
Iteration 1:   log likelihood = -9736.0937  
Iteration 2:   log likelihood = -9736.0937  

Conditional (fixed-effects) logistic regression

                                                Number of obs     =     26,166
                                                LR chi2(15)       =      12.41
                                                Prob > chi2       =     0.6481
Log likelihood = -9736.0937                     Pseudo R2         =     0.0006

------------------------------------------------------------------------------------------------------------------
                           tEver_infect_parasite | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------------------------------------------+----------------------------------------------------------------
                                             imd |
                               1 least deprived  |   .9804319   .0676519    -0.29   0.775     .8564119    1.122412
                                              2  |   .9587468   .0658636    -0.61   0.540       .83797    1.096931
                                              3  |   .9764065   .0671119    -0.35   0.728     .8533448    1.117215
                                              4  |    1.01139   .0696565     0.16   0.869     .8836787    1.157557
                                5 most deprived  |   .9713184   .0670039    -0.42   0.673     .8484839    1.111935
                                                 |
                                       ethnicity |
                                          Mixed  |   .9783886   .0381425    -0.56   0.575     .9064155    1.056077
                         Asian or Asian British  |   .9908935    .038911    -0.23   0.816     .9174903    1.070169
                                          Other  |   .9563409   .0376447    -1.13   0.257     .8853331    1.033044
                                                 |
                                     rural_urban |
                        urban minor conurbation  |   .9338066   .0584025    -1.10   0.274     .8260774    1.055585
                            urban city and town  |   .9040006   .0570459    -1.60   0.110     .7988306    1.023017
        urban city and town in a sparse setting  |   .8546607   .0530399    -2.53   0.011     .7567781    .9652035
                          rural town and fringe  |   .9316494   .0582294    -1.13   0.257     .8242353    1.053062
      rural town and fringe in a sparse setting  |   .9916855   .0619577    -0.13   0.894     .8773913    1.120868
                    rural village and dispersed  |   .9504911   .0516337    -0.93   0.350      .854492    1.057275
rural village and dispersed in a sparse setting  |   .9459939   .0515843    -1.02   0.309     .8501057    1.052698
------------------------------------------------------------------------------------------------------------------
tEver_infect_parasite

. 
. cap file close tablecontents 

. cap log close
